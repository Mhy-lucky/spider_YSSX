# 服务器跑代码，在服务器上安装 Conda 并创建 Python 环境
___

### 1️⃣ 登录服务器

```bash
ssh h29
```

登录后，会看到类似：

```
[maohongyao@localhost ~]$
```

---

### 2️⃣ 服务器未安装 Conda 时的一条命令安装脚本

```bash
ssh h29 "bash -c '\
# 下载并安装 Miniconda
wget -O ~/Miniconda3-latest-Linux-x86_64.sh https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh && \
bash ~/Miniconda3-latest-Linux-x86_64.sh -b -p ~/miniconda3 && \
# 使用国内镜像，避免 TOS 和下载慢
~/miniconda3/bin/conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/ && \
~/miniconda3/bin/conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/ && \
# 接受官方 TOS
~/miniconda3/bin/conda tos accept --override-channels --channel https://repo.anaconda.com/pkgs/main && \
~/miniconda3/bin/conda tos accept --override-channels --channel https://repo.anaconda.com/pkgs/r && \
# 创建 Python 3.10 环境
~/miniconda3/bin/conda create -n myenv python=3.10 -y || true && \
# 安装依赖
~/miniconda3/bin/conda run -n myenv pip install selenium requests -i https://pypi.tuna.tsinghua.edu.cn/simple && \
# 验证 Python 和 Selenium
~/miniconda3/bin/conda run -n myenv python -c \"import sys; print(\\\"Python version:\\\", sys.version)\" && \
~/miniconda3/bin/conda run -n myenv python -c \"import selenium; print(\\\"Selenium version:\\\", selenium.__version__)\" && \
# 运行你的 Python 脚本
~/miniconda3/bin/conda run -n myenv python your_script.py\
'"
```

> 替换 `your_script.py` 为你自己的脚本路径

---

### 3️⃣ 服务器已安装 Conda 时的一条命令脚本

```bash
ssh h29 "bash -c '\
# 使用国内镜像
~/miniconda3/bin/conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/ && \
~/miniconda3/bin/conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/ && \
# 接受官方 TOS
~/miniconda3/bin/conda tos accept --override-channels --channel https://repo.anaconda.com/pkgs/main && \
~/miniconda3/bin/conda tos accept --override-channels --channel https://repo.anaconda.com/pkgs/r && \
# 创建 Python 3.10 环境（已存在不会报错）
~/miniconda3/bin/conda create -n myenv python=3.10 -y || true && \
# 安装依赖
~/miniconda3/bin/conda run -n myenv pip install selenium requests -i https://pypi.tuna.tsinghua.edu.cn/simple && \
# 验证 Python 和 Selenium
~/miniconda3/bin/conda run -n myenv python -c \"import sys; print(\\\"Python version:\\\", sys.version)\" && \
~/miniconda3/bin/conda run -n myenv python -c \"import selenium; print(\\\"Selenium version:\\\", selenium.__version__)\" && \
# 运行你的 Python 脚本
~/miniconda3/bin/conda run -n myenv python your_script.py\
'"
```

---

### 4️⃣ 安装完成后的验证

```bash
# 查看 Python 版本
python --version

# 查看 Selenium 版本
python -c "import selenium; print(selenium.__version__)"
```

* Python 应该是你指定的版本（如 3.10.18）
* Selenium 应该可以正常导入（如 4.35.0）

---

### 5️⃣ 后台运行脚本示例

```bash
~/miniconda3/bin/conda run -n myenv nohup python your_script.py > output.log 2>&1 &
```

---

### 6️⃣ 登录服务器后继续使用 Conda 环境

```bash
source ~/miniconda3/bin/activate
conda activate myenv
```

然后就可以直接运行你的 Python 脚本。

---

### 7️⃣ 常见问题与解决方法

| 问题                                                      | 原因        | 解决方法                                                 |
| ------------------------------------------------------- | --------- | ---------------------------------------------------- |
| 安装报 `--More--`                                          | 安装许可证分页显示 | 使用 `-b` 无交互安装，或按空格回车继续                               |
| 安装路径有空格报错 `Cannot install into directories with spaces` | 路径不合法     | 选择无空格路径，例如 `~/miniconda3`                            |
| 激活 Conda 报错 `No such file or directory`                 | 路径写错      | 使用 `source ~/miniconda3/bin/activate`                |
| 创建环境报 `EnvironmentNameNotFound`                         | 环境不存在     | 先用 `conda info --envs` 查看，再创建新环境                     |
| pip 下载超时                                                | 网络问题      | 使用国内镜像：`-i https://pypi.tuna.tsinghua.edu.cn/simple` |

---

### 8️⃣ 优点

* 一键完成安装、环境创建、依赖安装、版本验证和脚本运行
* 支持国内镜像加速下载
* 不需要管理员权限
* 可直接后台运行脚本

#####  ps:
* 1.已经新建好了环境，每次需要从服务器进入环境时：
```bash
source ~/miniconda3/bin/activate
conda activate myenv
```
* 2.已经上传到服务器上的文件、文件夹，文件内容/文件夹内容在本地有改动的同步方法：
  在本地终端输入rsync -avz --progress "/Users/admin/Desktop/爬虫实习/0814/" h29:/home/maohongyao/0814/

---








