明白，我帮你把**日志更新为更完整版本**，把清洗方法、各工具的作用、适用性，以及“脏关键词”具体说明都补充上。下面是更新后的版本：

---

# 数据清洗日志（小说大文件）

**清洗日期**：2025-08-28
**脚本版本**：全功能融合版（正则+AC自动机+去重+保序+AWK辅助）
**输入文件**：`/data1/to_hongyao/chinese_web_novel.zh`
**输出文件**：`/data1/to_hongyao/data_clean_all.zh`
**总行数**：`待统计`

---

## 一、清洗目标

1. **保序去重**：确保每行唯一，保留原始顺序。
2. **广告/品牌过滤**：过滤小说网站名称、广告语及常见品牌。
3. **脏关键词过滤**：删除作者废话、加更提示、打赏信息、问号或其他乱码符号等。
4. **HTML及URL过滤**：删除HTML标签、网址、邮箱、QQ号等。
5. **控制字符及特殊符号过滤**：删除零宽字符、非打印字符、重复符号、特殊符号（如★☆●◆■□等）。
6. **章节标题过滤**：删除整行章节标题（如“第一章”）。
7. **非内容关键词过滤**：删除版权声明、作者简介、收藏提示等非正文信息。
8. **半句/生僻字过滤**：只保留中文文本，结尾标点完整，删除非允许字符。
9. **长度及数字过滤**：删除空行、过长行、纯数字行。
10. **大文件高效处理**：结合Python+AWK，可快速分块、逐行处理，避免内存占用过高。

---

## 二、清洗方法说明

| 方法                       | 功能        | 作用与适用性                                                     |
| ------------------------ | --------- | ---------------------------------------------------------- |
| **正则表达式**                | 匹配模式过滤    | 快速处理固定格式文本，如HTML标签、URL、章节标题、特殊符号、重复字符、问号重复等，适用于结构化和半结构化文本。 |
| **AC自动机 (Aho-Corasick)** | 批量关键词匹配   | 高效检测大量脏关键词、括号内关键词和允许字符，尤其适合百GB以上大文件的高效匹配，避免逐个正则匹配的慢速问题。    |
| **去重 (hash set)**        | 保序去重      | 利用哈希快速判断重复行，保证保留顺序，避免重复内容对下游任务干扰。                          |
| **保序处理**                 | 逐行输出      | 保留原始文件行顺序，方便原始列解析和分析。                                      |
| **AWK辅助**                | 文本分块、初步过滤 | 可快速处理大文件，例如按列筛选、删除空行或简单正则过滤，适合大文件预处理阶段，减轻Python内存压力。       |

---

## 三、清洗规则说明

| 序号 | 类型        | 正则/关键词                                   | 说明                         |              |        |          |        |            |
| -- | --------- | ---------------------------------------- | -------------------------- | ------------ | ------ | -------- | ------ | ---------- |
| 1  | 中文检测      | `RE_CHINESE = [\u4e00-\u9fff]`           | 必须包含至少一个中文字符               |              |        |          |        |            |
| 2  | HTML标签    | `<[^>]+>`                                | 删除HTML标签                   |              |        |          |        |            |
| 3  | URL       | \`(http\[s]?://                          | [www.)\`](http://www.%29`) | 删除网址         |        |          |        |            |
| 4  | 邮箱        | `\b[\w\.-]+@[\w\.-]+\.\w+\b`             | 删除邮箱地址                     |              |        |          |        |            |
| 5  | QQ/手机号    | `\b\d{5,11}\b`                           | 删除QQ号或手机号                  |              |        |          |        |            |
| 6  | 章节        | `^第[\s零一二三四五六七八九十百千0-9]{1,10}[章节卷回]`     | 删除章节标题                     |              |        |          |        |            |
| 7  | 全标点       | `^[\s，。、“”‘’：；！？…—,.!?\-~··]+$`          | 整行全标点删除                    |              |        |          |        |            |
| 8  | 重复字符      | `(.)\1{5,}`                              | 重复6次及以上字符删除                |              |        |          |        |            |
| 9  | 控制字符      | `[\x00-\x1f]`                            | 删除不可打印控制字符                 |              |        |          |        |            |
| 10 | 双斜杠       | `//`                                     | 删除双斜杠                      |              |        |          |        |            |
| 11 | 特殊符号      | `[★☆●◆■□▲▼※◎○◇]`                         | 删除特殊符号                     |              |        |          |        |            |
| 12 | 广告句型      | \`(百度搜索.\*                               | 白金小说网.\*                   | 随梦小说网.\*     | ...)\` | 删除常见广告句型 |        |            |
| 13 | 品牌/网站     | 列表 `SITE_BRANDS`                         | 删除小说网站或品牌信息                |              |        |          |        |            |
| 14 | 非内容关键词    | 列表 `NON_CONTENT_KEYWORDS`                | 删除版权、目录、收藏提示等              |              |        |          |        |            |
| 15 | 脏关键词      | AC自动机 `DIRTY_AC`                         | 删除作者废话、加更提示、打赏、问号重复、乱码标点等  |              |        |          |        |            |
| 16 | 括号内脏关键词   | AC自动机 `BRACKET_AC`                       | 括号内出现脏词删除                  |              |        |          |        |            |
| 17 | 生僻字检测     | AC自动机 `ALLOWED_AC`                       | 仅允许指定汉字、标点和数字              |              |        |          |        |            |
| 18 | 重复问号      | \`?{2,}                                  | ？{2,}\`                    | 删除问号重复两次及以上行 |        |          |        |            |
| 19 | 整句括号      | `^[（(].*[)）]`                            | 整句被括号包裹删除                  |              |        |          |        |            |
| 20 | 结尾合法标点    | \`(。                                     | ！                          | ？            | 。”     | ！”       | ？”)$\` | 删除结尾不规范的半句 |
| 21 | 空行/纯数字/超长 | `len(text) > MAX_LEN` / `text.isdigit()` | 删除空行、数字行、超过300字符行          |              |        |          |        |            |
| 22 | AWK辅助     | `awk '{if($3!="") print $0}'`            | 可快速删除空列、预筛选第三列文本，适合大文件预处理  |              |        |          |        |            |

---


## 四、清洗效果

1. **文本质量显著提升**：无广告、HTML标签和杂质，适合NLP训练或小说数据分析。
2. **保留原始行格式**：可直接按列分析，第三列为正文。
3. **高效大文件处理**：支持百GB级别文件，结合AWK预处理和Python+AC自动机处理，内存占用低且速度快。
4. **脏关键词覆盖广**：作者废话、加更、打赏提示、问号重复及乱码标点均已过滤。
5. **可复用清洗模块**：正则、AC自动机、AWK、去重、保序均可独立使用，灵活适应不同文件规模。

---

## 五、建议与改进

1. 持续更新`DIRTY_KEYWORDS`和`SITE_BRANDS`以适应新的小说平台或作者风格。
2. 根据实际需求调整`DEFAULT_MAX_LEN`，适应长段落或精简段落。
3. 可增加低频字过滤、拼音检测或语言模型辅助检测，提高文本纯度。
4. 对超大文件，可结合多进程或分块处理+AWK预处理，提高效率。

---

## 六、小tips
1. **作者废话**： 许多作者会在章节末尾添加“感谢大家支持”、“收藏加更”等废话，这些内容对正文无意义，需过滤。并且还可能直接一整行都是作者的废话，在括号内，可以采用整句括号匹配：整句被（）或()包裹的方法去除
2.Linux指令检查常用：
   - `wc -l filename`：统计文件行数
   - `head -n 10 filename`：查看文件前10行
   - `tail -n 10 filename`：查看文件后10行
   - `grep 'pattern' filename`：搜索包含特定模式的行
  ！！！！很常用 - `grep -En "\[.*\]|\（.*\）|【.*】" data.zh`：检查括号内是否有脏关键词