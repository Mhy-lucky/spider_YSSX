
# Selenium 爬虫调试（搜狗翻译）

### 问题

* 无头模式下无法获取翻译结果
* 页面能正常打开，但 `trans-result` 节点一直未出现，报 `TimeoutException`

---

### 解决方案和分析

#### 1️⃣ Chrome 配置优化详细过程

**之前失败原因：**

* 只用基础选项 `--headless` / `--disable-gpu` 等
  → 页面 JS 动态渲染未完成，`trans-result` 节点未生成
* 浏览器窗口过小或缺少用户代理
  → 页面识别为 bot
* 搜狗翻译有简单反爬检测（渲染速度、未触发点击/滚动）

**最终成功方案（DSCN 获取）：**

```python
chrome_options.add_argument("--headless=new")           # 新无头模式
chrome_options.add_argument("--window-size=1920,1080")  # 大窗口
chrome_options.add_argument("--disable-gpu")            
chrome_options.add_argument("--no-sandbox")             
chrome_options.add_argument("--disable-dev-shm-usage")  
chrome_options.add_argument("--disable-features=VizDisplayCompositor")
chrome_options.add_argument("user-agent=Mozilla/5.0 ...")
chrome_options.add_experimental_option("excludeSwitches", ["enable-automation"])
chrome_options.add_experimental_option("useAutomationExtension", False)
```

**关键点总结：**

* 新无头模式保证兼容性
* 大窗口 + 用户代理模拟真实浏览器
* 禁用特定功能避免渲染异常
* 模拟用户操作（滚动、点击 body）保证动态内容加载
* 配合等待机制，直到 `trans-result` 出现

> 找CSDN啊

---

#### 2️⃣ 文件处理分块逻辑

```python
def chunk_paragraphs(text, max_chars=1000):
    paragraphs = text.splitlines()
    chunks = []

    for para in paragraphs:
        para = para.strip()
        if not para:
            chunks.append("")
            continue

        words = para.split()
        current_chunk = ""
        for word in words:
            if len(current_chunk) + len(word) + 1 > max_chars:
                chunks.append(current_chunk.strip())
                current_chunk = word + " "
            else:
                current_chunk += word + " "
        if current_chunk:
            chunks.append(current_chunk.strip())
    return chunks
```

**应用场景：**

* 大文件翻译 → 每次输入一段 → 翻译 → 写入输出
* 上传/同步大文件到服务器分块处理
* 可扩展到日志分析、批量写入数据库、API 批量调用等

---

#### 3️⃣ 获取翻译结果示例

```python
for _ in range(50):  # 最长等待 25 秒
    text = result_p.text.strip()
    if text and text != previous_text:
        lines = [line.strip() for line in text.splitlines() if line.strip() != ""]
        return lines
    driver.execute_script("arguments[0].scrollIntoView(true);", result_p)
    driver.execute_script("document.body.click();")
    time.sleep(0.5)
```

**关键点：**

* 分块输入 + 模拟操作 + 等待机制
* 保证无头模式下翻译稳定

---

#### 4️⃣ 总结

* **核心**：新无头模式 + 大窗口 + 用户代理 + 模拟操作
* **稳定获取翻译**：配合分块输入 + 等待机制
* 分块逻辑可复用到大文件处理、批量 API 调用、日志分析等

---
